<!-- Jobs Page -->
<div class="page-header">
    <h1><span data-en>Jobs & Internships</span><span data-tr>İş & Staj İlanları</span></h1>
    <p class="subtitle"><span data-en>Career opportunities for our students and alumni</span><span data-tr>Öğrenci ve mezunlarımız için kariyer fırsatları</span></p>
</div>

<div class="tabs" id="jobTabs">
    <button class="tab active" onclick="filterJobs('all', this)"><span data-en>All</span><span data-tr>Tümü</span></button>
    <button class="tab" onclick="filterJobs('full-time', this)"><span data-en>Full-Time</span><span data-tr>Tam Zamanlı</span></button>
    <button class="tab" onclick="filterJobs('internship', this)"><span data-en>Internship</span><span data-tr>Staj</span></button>
    <button class="tab" onclick="filterJobs('part-time', this)"><span data-en>Part-Time</span><span data-tr>Yarı Zamanlı</span></button>
</div>

<div id="jobsList">
    <div class="card-compact skeleton" style="height:70px;"></div>
    <div class="card-compact skeleton" style="height:70px;"></div>
</div>

<script>
(function() {
    let currentFilter = 'all';
    
    window.filterJobs = function(filter, btn) {
        currentFilter = filter;
        document.querySelectorAll('#jobTabs .tab').forEach(t => t.classList.remove('active'));
        btn.classList.add('active');
        renderJobsPage();
    };
    
    function cleanText(str) {
        if (!str) return '';
        return str.replace(/Â·/g, '·').replace(/Â /g, ' ').replace(/Â/g, '');
    }
    
    window.renderJobsPage = function() {
        let data = getData('jobs');
        const container = document.getElementById('jobsList');
        
        if (!data || data.length === 0) {
            container.innerHTML = `<p>${t('No jobs available.', 'İş ilanı bulunamadı.')}</p>`;
            return;
        }
        
        // Filter by type
        if (currentFilter !== 'all') {
            data = data.filter(j => (j.type || '').toLowerCase().includes(currentFilter.replace('-', '')));
        }
        
        container.innerHTML = data.map((j, i) => {
            const originalIndex = getData('jobs').indexOf(j);
            const typeClass = (j.type || '').toLowerCase().includes('intern') ? 'tag-green' : 
                              (j.type || '').toLowerCase().includes('part') ? 'tag-amber' : 'tag-accent';
            
            return `
            <div class="card-compact card-clickable" onclick="goToJobDetail(${originalIndex})" style="cursor:pointer;">
                <div class="card-compact-icon" style="background:var(--accent-light); color:var(--accent);">
                    <i class="fa-solid fa-briefcase"></i>
                </div>
                <div class="card-compact-content">
                    <h4>${t(j.title_en, j.title_tr)}</h4>
                    <p>${cleanText(j.company)} · ${cleanText(j.location)} ${j.salary ? '· ' + cleanText(j.salary) : ''}</p>
                </div>
                <span class="tag ${typeClass}">${j.type || 'Job'}</span>
            </div>
            `;
        }).join('');
    };
    
    // Detail navigation - set index and navigate, then force render
    window.goToJobDetail = function(index) {
        console.log('goToJobDetail called with index:', index);
        window.currentDetailPage = 'job';
        window.currentDetailIndex = index;
        Router.goTo('job-detail');
        // Force render after a short delay to ensure page is loaded
        setTimeout(() => {
            if (typeof window.renderJobDetailPage === 'function') {
                window.renderJobDetailPage();
            }
        }, 100);
    };
    
    // Render will be called by router after page loads
})();
</script>
