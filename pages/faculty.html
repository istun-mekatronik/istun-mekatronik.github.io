<!-- ═══════════════════════════════════════════════════════════════════════════
     FACULTY PAGE
     Data required: faculty, publications, courses, research, students, projects
     ═══════════════════════════════════════════════════════════════════════════ -->

<div class="page-header">
    <h1><span data-en>Faculty Directory</span><span data-tr>Akademik Kadro</span></h1>
    <p class="subtitle">
        <span data-en>Our researchers and educators</span>
        <span data-tr>Araştırmacılarımız ve eğitimcilerimiz</span>
    </p>
</div>

<!-- Faculty Grid -->
<div class="faculty-grid" id="facultyGrid">
    <div class="faculty-card skeleton" style="height:220px;"></div>
    <div class="faculty-card skeleton" style="height:220px;"></div>
    <div class="faculty-card skeleton" style="height:220px;"></div>
</div>

<!-- Profile Modal (shown when clicking a faculty member) -->
<div class="modal-overlay" id="profileModal" onclick="if(event.target===this)closeProfile()">
    <div class="profile-modal">
        <button class="btn btn-ghost profile-close" onclick="closeProfile()">
            <i class="fa-solid fa-times"></i>
        </button>
        
        <div class="profile-layout">
            <aside class="profile-sidebar">
                <div class="profile-photo-container">
                    <img id="profPhoto" src="" alt="Faculty">
                </div>
                <div id="profLinks" class="profile-contact-list"></div>
            </aside>
            
            <main class="profile-main">
                <h1 id="profName">Loading...</h1>
                <p class="profile-title" id="profTitle"></p>
                
                <div id="profBioSection">
                    <h2><span data-en>Biography</span><span data-tr>Biyografi</span></h2>
                    <p id="profBio" class="profile-bio"></p>
                </div>
                
                <div class="profile-meta-grid">
                    <div class="meta-item">
                        <label><span data-en>Research Areas</span><span data-tr>Araştırma Alanları</span></label>
                        <p id="profResearch"></p>
                    </div>
                    <div class="meta-item" id="profEducationSection">
                        <label><span data-en>Education</span><span data-tr>Eğitim</span></label>
                        <p id="profEducation"></p>
                    </div>
                    <div class="meta-item" id="profOfficeSection">
                        <label><span data-en>Office</span><span data-tr>Ofis</span></label>
                        <p id="profOffice"></p>
                    </div>
                </div>
                
                <div id="profPublicationsSection" style="display:none;">
                    <h2><span data-en>Publications</span><span data-tr>Yayınlar</span></h2>
                    <div id="profPublications" class="profile-related-list"></div>
                </div>
                
                <div id="profCoursesSection" style="display:none;">
                    <h2><span data-en>Courses Taught</span><span data-tr>Verilen Dersler</span></h2>
                    <div id="profCourses" class="profile-related-list"></div>
                </div>
            </main>
        </div>
    </div>
</div>

<script>
// Current profile name for re-rendering on language change
let currentProfileName = null;

function renderFacultyPage() {
    const data = getData();
    
    document.getElementById('facultyGrid').innerHTML = data.faculty.map(f => `
        <div class="faculty-card card-clickable" onclick="openProfile('${(f.name || '').replace(/'/g, "\\'")}')">
            <img src="${f.photo || `https://ui-avatars.com/api/?name=${encodeURIComponent(f.name || 'F')}&background=6366f1&color=fff&size=120`}" 
                 class="faculty-avatar" alt="${f.name}">
            <h3 class="faculty-name">${f.name}</h3>
            <p class="faculty-title">${f.title}</p>
            <div class="faculty-field">${t(f.research_en, f.research_tr)}</div>
            <div class="faculty-links-spacer"></div>
            <div class="faculty-links">
                ${f.email ? `<a href="mailto:${f.email}" title="Email" onclick="event.stopPropagation()"><i class="fa-solid fa-envelope"></i></a>` : ''}
                ${f.yok_cv ? `<a href="${f.yok_cv}" target="_blank" title="${t('CoHE Academic CV', 'YÖK Akademik CV')}" onclick="event.stopPropagation()"><i class="fa-solid fa-graduation-cap"></i></a>` : ''}
                ${f.scholar ? `<a href="${f.scholar}" target="_blank" title="Google Scholar" onclick="event.stopPropagation()"><i class="fa-brands fa-google-scholar"></i></a>` : ''}
            </div>
        </div>
    `).join('') || `<p>${t('No faculty data.', 'Akademisyen verisi yok.')}</p>`;
    
    // Re-render profile if open
    if (currentProfileName) {
        renderProfile(currentProfileName);
    }
}

function openProfile(name) {
    currentProfileName = name;
    renderProfile(name);
    document.getElementById('profileModal').classList.add('show');
}

function closeProfile() {
    document.getElementById('profileModal').classList.remove('show');
    currentProfileName = null;
}

function renderProfile(name) {
    const data = getData();
    const f = data.faculty.find(item => item.name === name);
    if (!f) return;
    
    document.getElementById('profName').textContent = f.name;
    document.getElementById('profTitle').textContent = f.title;
    document.getElementById('profPhoto').src = f.photo || `https://ui-avatars.com/api/?name=${encodeURIComponent(f.name || 'F')}&background=6366f1&color=fff&size=400`;
    document.getElementById('profResearch').textContent = t(f.research_en, f.research_tr) || '—';
    
    // Bio
    const bio = t(f.bio_en, f.bio_tr);
    document.getElementById('profBioSection').style.display = bio ? 'block' : 'none';
    document.getElementById('profBio').textContent = bio || '';
    
    // Education
    const edu = t(f.education_en, f.education_tr);
    document.getElementById('profEducationSection').style.display = edu ? 'block' : 'none';
    document.getElementById('profEducation').textContent = edu || '';
    
    // Office
    document.getElementById('profOfficeSection').style.display = f.office ? 'block' : 'none';
    document.getElementById('profOffice').textContent = f.office || '';
    
    // Links
    const linksHTML = [];
    if (f.email) linksHTML.push(`<a href="mailto:${f.email}" class="profile-contact-link"><i class="fa-solid fa-envelope"></i> ${f.email}</a>`);
    if (f.yok_cv) linksHTML.push(`<a href="${f.yok_cv}" target="_blank" class="profile-contact-link"><i class="fa-solid fa-graduation-cap"></i> ${t('CoHE Academic CV', 'YÖK Akademik CV')}</a>`);
    if (f.scholar) linksHTML.push(`<a href="${f.scholar}" target="_blank" class="profile-contact-link"><i class="fa-brands fa-google-scholar"></i> Google Scholar</a>`);
    document.getElementById('profLinks').innerHTML = linksHTML.join('') || `<p class="text-muted">${t('No links', 'Link yok')}</p>`;
    
    // Related publications
    const facultyName = f.name.toLowerCase();
    const lastName = f.name.split(' ').pop().toLowerCase();
    const relatedPubs = data.publications.filter(p => {
        const authors = (p.authors || '').toLowerCase();
        return authors.includes(facultyName) || authors.includes(lastName);
    });
    
    if (relatedPubs.length > 0) {
        document.getElementById('profPublicationsSection').style.display = 'block';
        document.getElementById('profPublications').innerHTML = relatedPubs.slice(0, 5).map(p => `
            <div class="profile-related-item">
                <h4>${p.title || ''}</h4>
                <p>${p.journal || ''}${p.journal && p.year ? ', ' : ''}${p.year || ''}</p>
            </div>
        `).join('');
    } else {
        document.getElementById('profPublicationsSection').style.display = 'none';
    }
    
    // Related courses
    const relatedCourses = data.courses.filter(c => {
        const instructor = (c.instructor || '').toLowerCase();
        return instructor.includes(facultyName) || instructor.includes(lastName);
    });
    
    if (relatedCourses.length > 0) {
        document.getElementById('profCoursesSection').style.display = 'block';
        document.getElementById('profCourses').innerHTML = relatedCourses.map(c => `
            <div class="profile-related-item">
                <span class="tag tag-accent">${c.code || ''}</span>
                <h4>${t(c.name_en, c.name_tr) || ''}</h4>
                <p>${c.ects ? c.ects + ' ECTS' : ''}</p>
            </div>
        `).join('');
    } else {
        document.getElementById('profCoursesSection').style.display = 'none';
    }
}
</script>
